(function(){var aB=document.getElementById("Canvas"),E=aB.getContext("2d");aB.width=320;aB.height=430;var ae=false;var P=false;var K=true;var ah=500;var V={clear:function(){E.clearRect(0,0,aB.width,aB.height)},line:function(aE,aH,e,aF,aG,aD){E.beginPath();E.moveTo(aE,aH);E.lineTo(e,aF);E.closePath();E.lineWidth=aG;E.strokeStyle=aD;E.stroke()},rect:function(e,aG,aD,aF,aE){E.fillStyle=aE;E.fillRect(e,aG,aD,aF)},circle:function(aD,aF,e,aE){E.fillStyle=aE;E.beginPath();E.arc(aD,aF,e,0,Math.PI*2,true);E.closePath();E.fill()},circleoutline:function(aD,aG,e,aE,aF){E.beginPath();E.arc(aD,aG,e,0,Math.PI*2,true);E.closePath();E.lineWidth=aF;E.strokeStyle=aE;E.stroke()},text:function(aF,e,aG,aE,aD){E.font="bold "+aE+"px verdana";E.fillStyle=aD;E.fillText(aF,e,aG)}};splashImage=new Image();splashImage.src="images/splash-page.png";instructionsImage=new Image();instructionsImage.src="images/instructions-page.png";coinImage=new Image();coinImage.src="images/gratiicoin25b.png";gImage=new Image();gImage.src="images/g.png";gPlusImage=new Image();gPlusImage.src="images/g-plus.png";gMinusImage=new Image();gMinusImage.src="images/g-minus.png";arrowImage=new Image();arrowImage.src="images/arrow-split.png";buttonBackImage=new Image();buttonBackImage.src="images/button3.png";chipsImage=new Image();chipsImage.src="images/chips.png";var at=0;function d(){$.get("../../users/php/getUserGratii.php",function(e){if(e!=null){n=e}})}function aw(){var e=navigator.onLine;if(e==false){alert("Oh no! You lost internet connection.");window.location="../../users/html/arcade.html";return}if(n=="wait.."){alert("Please wait for your chips to update. Internet connection is slow.");return}$.post("../api/gameOver.php",{score:(az*-1)},"json")}function N(){var e=navigator.onLine;if(e==false){alert("Oh no! You lost internet connection.");window.location="../../users/html/arcade.html";return}n="wait..";$.post("../api/gameOver.php",{score:at},function(aD){n=aD.gratiiAfter},"json")}function W(e,aD){this.num=e;this.suit=aD;this.image=new Image();this.image.src="images/"+this.num+"_"+this.suit+".png"}function aq(){this.image=new Image();this.image.src="images/cardback.png"}function aA(){this.cards=new Array(52);this.next_card=0;for(i=1;i<14;i++){this.cards[i-1]=new W(i,"c");this.cards[i+12]=new W(i,"h");this.cards[i+25]=new W(i,"s");this.cards[i+38]=new W(i,"d")}this.shuffle=function(){for(i=1;i<1000;i++){card1=Math.floor(52*Math.random());card2=Math.floor(52*Math.random());temp=this.cards[card2];this.cards[card2]=this.cards[card1];this.cards[card1]=temp}this.next_card=0};this.dealCard=function(){return this.cards[this.next_card++]}}function ai(e){Y=new Array();if(n>=e){n-=e;az+=e;z+=e;if(az>ah){alert("Max bet is "+ah+" Gratii");az-=e;n+=e;z=az}}else{if(n=="wait.."){alert("Please wait for your chips to update. Internet connection is slow.")}else{alert("Not enough Gratii bro")}}}function v(e){n+=e;az=0}function L(){z=az;az=0}function ap(){z=az}function x(){if(am=="deal"){if(aj.next_card>39){aj.shuffle()}ar=new Array();A=new Array();Y=new Array();ar[0]=aj.dealCard();ar[1]=aj.dealCard();A[0]=aj.dealCard();A[1]=aj.dealCard()}}function J(){X=C(A);if(X==21&&A.length==2&&am=="play"){av();return}}function C(aE){if(aE!=null){var aF=0;var aD=0;var e=0;for(i=0;i<aE.length;i++){e=aE[i].num;if(e==1){aD=aD+1;aF=aF+11}else{if(e==11||e==12||e==13){aF=aF+10}else{aF=aF+e}}}while(aD>0&&aF>21){aF=aF-10;aD=aD-1}return aF}}function af(aE){var aF=0;var aD=0;var e=0;e=aE.num;if(e==1){aD=aD+1;aF=aF+11}else{if(e==11||e==12||e==13){aF=aF+10}else{aF=aF+e}}while(aD>0&&aF>21){aF=aF-10;aD=aD-1}return aF}function q(){if(am!="split"){var e=C(A);var aD=C(ar);if(e==21&&A.length==2){return"playerblackjack"}if(e==21&&A.length==2&&aD==21){return"tie"}if(e>21){return"dealer"}else{if(aD>21){return"player"}else{if(e==aD){return"tie"}else{if(e>aD){return"player"}else{return"dealer"}}}}}else{if(am=="split"&&ak==1){var e=C(A);var aD=C(ar);if(e==21&&A.length==2){return"playerblackjack"}if(e==21&&A.length==2&&aD==21){return"tie"}if(e>21){return"dealer"}else{if(aD>21){return"player"}else{if(e==aD){return"tie"}else{if(e>aD){return"player"}else{return"dealer"}}}}}else{if(am=="split"&&ak==2){var aE=C(Y);var aD=C(ar);if(aE==21&&Y.length==2){return"playerblackjack"}if(aE==21&&Y.length==2&&aD==21){return"tie"}if(aE>21){return"dealer"}else{if(aD>21){return"player"}else{if(aE==aD){return"tie"}else{if(aE>aD){return"player"}else{return"dealer"}}}}}}}}function F(e){if(am!="split"){if(e=="dealer"){T-=az;am="game_over";winState="none";at=0}if(e=="player"){at+=az*2;n+=az*2;T+=az;am="game_over";winState="none"}if(e=="tie"){at+=az;n+=az;am="game_over";winState="none"}if(e=="playerblackjack"){at+=Math.round(((3/2)*az)+az);n+=Math.round(((3/2)*az)+az);T+=Math.round((3/2)*az);am="game_over";winState="none"}}else{if(am=="split"&&ak==1){ab=0;if(e=="dealer"){ab-=Math.round(az/2);T-=az/2;ak=2;at=0}if(e=="player"){T+=az;ab+=Math.round(az);ak=2}if(e=="tie"){ab+=Math.round(az/2);ak=2}if(e=="playerblackjack"){T+=az/2;ab+=Math.round(az);ak=2}}else{if(am=="split"&&ak==2){if(ab>0){at+=ab;n+=ab}else{if(ab<0){}else{if(ab==0){}}}if(e=="dealer"){T-=Math.round(az/2);am="split_game_over";winState="none";at=0}if(e=="player"){at+=Math.round(az);n+=Math.round(az);T+=Math.round(az/2);am="split_game_over";winState="none"}if(e=="tie"){at+=Math.round(az/2);n+=Math.round(az/2);am="split_game_over";winState="none"}if(e=="playerblackjack"){at+=Math.round(az);n+=Math.round(az);T+=Math.round(az/2);am="split_game_over";winState="none"}}}}N(at);at=0}function g(){am="deal";o="none";at=0;t=true;if(t==true&&az==0){t=false;am="bet";o="none";alert("You must place a bet to play at this table bro")}else{if(t==true&&az>=1){aw()}}}function b(){if(am!="split"){var e=0;if(am=="game_over"){alert("Game over.  Click the Deal button to start a new hand.")}else{e=A.length;A[e]=aj.dealCard();X=C(A);if(B==true){B=false;if(X>21){o=q();F(o);return}else{av();return}}if(X>21){o=q();F(o)}else{if(X==21){av()}else{}}}}else{if(am=="split"&&ak==1){var e=0;if(am=="game_over"){alert("Game over.  Click the Deal button to start a new hand.")}else{e=A.length;A[e]=aj.dealCard();X=C(A);if(X>21){o=q();F(o)}else{if(X==21){av()}else{}}}}else{if(am=="split"&&ak==2){var e=0;if(am=="game_over"){alert("Game over.  Click the Deal button to start a new hand.")}else{e=Y.length;Y[e]=aj.dealCard();a=C(Y);if(a>21){o=q();F(o)}else{if(a==21){av()}else{}}}}}}}function av(){var e=0;if(am=="game_over"){}else{while(C(ar)<17){e=ar.length;ar[e]=aj.dealCard()}ac=C(ar);o=q();F(o);return}}function c(){Y=new Array();if(n>=z){n-=z;az=z;g()}else{if(n=="wait.."){alert("Please wait for your chips to update. Internet connection is slow.")}else{alert("Not enough gratii bro")}}}var B=false;function au(){if(am!="split"){if(A.length==2){if(n>=az){aw();n-=az;az*=2;B=true;b()}else{alert("Not enough gratii bro")}}else{alert("You have too many cards to double down.")}}else{if(am=="split"){}}}function p(){if(A[0].num==A[1].num){if(n>=az){aw();n-=az;az*=2;console.log("betTotal doubled for Split");Y[0]=A[1];A[1]=aj.dealCard();Y[1]=aj.dealCard();ak=1;am="split"}else{alert("Not enough gratii bro")}}else{alert("Your cards must match to split.")}}function j(){Y=new Array();az=0;z=0;t=false;am="bet";o="none"}function ay(){exitGame()}function D(){alert("Try to get 21.")}function y(aI,aH,aF,aG,aE,aD,e){this.x=aI;this.y=aH;this.width=aF;this.height=aG;this.text=aE;this.textx=aD;this.texty=e;this.textcolor="#777777";this.fontSize=16;this.clicked=function(aK,aJ){if(u(aK,aJ,this.x,this.y,this.width,this.height)==true){return true}};this.draw=function(){aB.getContext("2d").drawImage(buttonBackImage,this.x,this.y+12);V.text(this.text,this.textx,this.texty-10,this.fontSize,this.textcolor)};this.showCollisionOutline=function(){E.globalAlpha=0.5;V.rect(this.x,this.y,this.width,this.height,"red");E.globalAlpha=1}}function u(aJ,aI,aE,aH,aG,e){var aF=aH+e;var aD=aE+aG;if(aJ>aE&&aJ<aD&&aI>aH&&aI<aF){return true}else{return false}}function an(aD,e){if(K==true){if(P==true){K=false;P=false}if(u(aD,e,0,360,aB.width,70)==true){P=true}else{K=false;P=false}}else{if(K==false){if(u(aD,e,0,0,59,34)==true){ay()}if(u(aD,e,60,0,44,34)==true){D()}if(am=="bet"){if(r.clicked(aD,e)==true){g()}}else{if(am=="game_over"||am=="split_game_over"){if(H.clicked(aD,e)==true){j()}if(ao.clicked(aD,e)==true){c()}}else{if(am=="play"){if(f.clicked(aD,e)==true){b()}if(aa.clicked(aD,e)==true){av()}if(ax.clicked(aD,e)==true){au()}if(S.clicked(aD,e)==true){p()}}else{if(am=="split"){if(U.clicked(aD,e)==true){b()}if(s.clicked(aD,e)==true){av()}}}}}if(am=="bet"){if(u(aD,e,h,aB.height-140,49,60)==true){ai(5)}if(u(aD,e,h+50,aB.height-142,51,60)==true){ai(25)}if(u(aD,e,h+102,aB.height-144,57,60)==true){ai(100)}if(u(aD,e,112,aB.height/2-72,al()-60,80)==true){v(az)}}}}}function I(){var e=16;if(am=="bet"){aB.getContext("2d").drawImage(chipsImage,160,aB.height-138);r.draw()}else{if(am=="game_over"||am=="split_game_over"){H.draw();ao.draw()}else{if(am=="play"){f.draw();aa.draw();ax.draw();S.draw()}else{if(am=="split"){U.draw();s.draw()}}}}}function ad(){if(am=="play"||am=="game_over"||am=="split"||am=="split_game_over"){for(var e=0;e<ar.length;e++){if(e==0&&am=="play"){aB.getContext("2d").drawImage(ag.image,120,50)}else{if(e==0&&am=="split"){aB.getContext("2d").drawImage(ag.image,120,44)}else{if(e==0&&am=="game_over"){aB.getContext("2d").drawImage(ar[e].image,120+e*22,50+e*4)}else{if(e==0&&am=="split_game_over"){aB.getContext("2d").drawImage(ar[e].image,120+e*22,44+e*2)}}}}if(e!=0&&am=="play"){aB.getContext("2d").drawImage(ar[e].image,120+e*22,50+e*4)}else{if(e!=0&&am=="game_over"){aB.getContext("2d").drawImage(ar[e].image,120+e*22,50+e*4)}else{if(e!=0&&am=="split_game_over"){aB.getContext("2d").drawImage(ar[e].image,120+e*22,44+e*2)}else{if(e==1&&am=="split"){aB.getContext("2d").drawImage(ar[e].image,120+e*22,44+e*2)}}}}}if(am!="split"&&am!="split_game_over"){for(var e=0;e<A.length;e++){aB.getContext("2d").drawImage(A[e].image,120+e*22,225+e*4)}}else{if(am=="split"||am=="split_game_over"){for(var e=0;e<A.length;e++){aB.getContext("2d").drawImage(A[e].image,50+e*22,142+e*2)}for(var e=0;e<Y.length;e++){aB.getContext("2d").drawImage(Y[e].image,50+e*22,240+e*2)}if(am=="split"){if(ak==1){aB.getContext("2d").drawImage(arrowImage,4,164)}else{if(ak==2){aB.getContext("2d").drawImage(arrowImage,4,264)}}}}}}}function Z(){if(am=="play"){if(C(ar)!=null&C(A)!=null){ac=(C(ar));X=(C(A));V.text(X,aB.width/2-8,aB.height-90,12,"#CCCCCC")}}else{if(am=="game_over"){if(C(ar)!=null&C(A)!=null){ac=(C(ar));X=(C(A));V.text("Dealer:"+ac,25,aB.height-290,12,"#CCCCCC");V.text(X,aB.width/2-8,aB.height-90,12,"#CCCCCC")}}else{if(am=="split"){if(C(ar)!=null&C(A)!=null){ac=(C(ar));X=(C(A));a=(C(Y));V.text(X,18,224,12,"#CCCCCC");V.text(a,18,314,12,"#CCCCCC")}}else{if(am=="split_game_over"){if(C(ar)!=null&C(A)!=null){ac=(C(ar));X=(C(A));a=(C(Y));V.text("Dealer:"+ac,25,aB.height-290,12,"#CCCCCC");V.text(X,18,224,12,"#CCCCCC");V.text(a,18,314,12,"#CCCCCC")}}}}}}function l(){var aF=250;if(n<10){aF=272}if(n>=10&&n<100){aF=261}if(n>=100&&n<1000){aF=250}if(n>=1000&&n<10000){aF=239}if(n>=10000&&n<100000){aF=228}V.text(n,aF,24,16,"#FFFFFF");aB.getContext("2d").drawImage(coinImage,288,5);var aD=105;var aG=198;V.text("Current Bet:",aD,30,12,"#cbcbcb");V.text(z,aG,30,12,"#cbcbcb");var aE=60;V.line(aE,0,aE,34,1,"#444444");V.text("?",aE+14,18,18,"#f4e450");V.text("Help",aE+7,30,10,"#cbcbcb");var e=0;V.text("X",e+24,18,18,"#f0603e");V.text("Cash Out",e+5,30,10,"#cbcbcb")}var aj=new aA();aj.shuffle();var ag=new aq();var M=0;var h=160;var az=0;var z=0;var T=0;var ab=0;var n=0;d();var am="bet";var o="none";var t=false;var ar;var A;var Y;var ak=0;var X=0;var a=0;var ac=0;var r=new y(120,aB.height-75,78,74,"Deal",140,aB.height-19);var f=new y(4,aB.height-75,78,74,"Hit",31,aB.height-19);var aa=new y(82,aB.height-75,78,74,"Stand",97,aB.height-19);var ax=new y(160,aB.height-75,78,74,"Double",168,aB.height-19);var S=new y(238,aB.height-75,78,74,"Split",257,aB.height-19);var H=new y(82,aB.height-75,78,74,"Clear",97,aB.height-19);var ao=new y(160,aB.height-75,78,74,"Re-Bet",168,aB.height-19);var U=new y(82,aB.height-75,78,74,"Hit",108,aB.height-19);var s=new y(160,aB.height-75,78,74,"Stand",173,aB.height-19);function al(){var e=142;if(az<10){e+=16;return e}else{if(az<100){e+=16*2;return e}else{if(az>=100&&az<1000){e+=16*3;return e}else{if(az>=1000&&az<10000){e+=16*4;return e}else{if(az>=10000&&az<100000){e+=16*5;return e}else{if(az>=100000){e+=16*6;return e}}}}}}}function m(){var aD=110;var e=al();if(am!="split"&&am!="split_game_over"){if(o=="player"){V.text("+"+az,aD,aB.height/2-20,24,"#02e807");aB.getContext("2d").drawImage(gPlusImage,e-10,aB.height/2-40)}else{if(o=="dealer"){V.text(" -"+az,aD,aB.height/2-20,24,"#f0603e");aB.getContext("2d").drawImage(gMinusImage,e-10,aB.height/2-40)}else{if(o=="tie"){V.text("Push",aD+4,aB.height/2-20,24,"#CCCCCC")}else{if(o=="none"&&az>0&&am!="split"){if(am=="bet"){E.globalAlpha=0.6;V.circle(e+16,aB.height/2-50,8,"#F4E450");E.globalAlpha=0.8;V.text("x",e+13,aB.height/2-45,12,"#cccccc");V.text("x",e+12,aB.height/2-46,12,"#222222");E.globalAlpha=1}V.text(az,aD+20,aB.height/2-20,24,"#f4e450");aB.getContext("2d").drawImage(gImage,e-10,aB.height/2-40)}else{if(o=="playerblackjack"){V.text("+"+Math.round((3/2)*az),aD,aB.height/2-20,24,"#02e807");aB.getContext("2d").drawImage(gPlusImage,e-10,aB.height/2-40)}}}}}}else{if(am=="split"){V.text("Your Bet:"+az,8,aB.height/2-75,14,"#f4e450")}else{if(am=="split_game_over"){if(ab<0){V.text(ab,aB.width-84,220,16,"#f0603e")}else{if(ab==0){V.text("Push",aB.width-90,220,16,"#CCCCCC")}else{if(ab>0){V.text("+"+ab,aB.width-90,220,16,"#02e807")}}}if(o=="player"){V.text("+"+az,aB.width-90,310,16,"#02e807")}else{if(o=="dealer"){V.text(" -"+az/2,aB.width-90,310,16,"#f0603e")}else{if(o=="tie"){V.text("Push",aB.width-90,310,16,"#CCCCCC")}}}}}}}function R(){if(P==true){aB.getContext("2d").drawImage(instructionsImage,0,0)}else{if(P==false){aB.getContext("2d").drawImage(splashImage,0,0)}}}function O(){if(K==true){R()}else{if(K==false){V.clear();if(t==true&&az>0&&am=="deal"){x();am="play"}else{if(t==true&&az==0&&am=="bet"){t=false;alert("You must place a bet to play at this table bro")}}ad();I();l();Z();m();J()}}}var w=setInterval(O,30);var Q="click";try{document.createEvent("TouchEvent");Q="touchstart";ae=true}catch(G){}if(ae==true){aB.addEventListener(Q,k,true);function k(aD){var aE={x:aD.changedTouches[0].clientX,y:aD.changedTouches[0].clientY};an(aE.x,aE.y)}}if(ae==false){function aC(aF){var aE=aB.getBoundingClientRect();var aD={x:aF.clientX-aE.left,y:aF.clientY-aE.top};an(aD.x,aD.y)}aB.addEventListener("click",aC,true)}console.log(ae)}());